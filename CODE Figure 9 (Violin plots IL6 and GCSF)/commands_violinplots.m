
load('Human_viral_load_data.mat')

viral_load_s2 = log10([16465.659618780002,492.5454000379935,2982.5809699610345,112.13330651783012,71.50619002827221,1120.224445309915,79.32467181991032 78.68939200468418]);
time_s2mod = [0,7,8,10,11,12,13,14]+7;

 
viral_load_s3 = log10([587200.73 24674751.46  35923.391  29932.350 4638.4470 1517.641870 438.6847 1266.41015 4152.7278 878.09191 730.9749 78.0068 2255.25641]);
time_s3mod = [0 1 2 3 4 5 6 7 8 9 10 11 12]+4; 

viral_load_s4 = log10([5555.516 5487.6627 11573.659 13699.799 97.98587 82.059313 91.893]);
time_s4mod = [0 4 7 9 11 12 13]+7;

viral_load_s10 = log10([94712.88475 3462.0839 22346.81 8252.0174 1279.4720 111.3866 109.7006 100.832]);
time_s10mod = [0 1 4 5 6 7 8 10]+6;

viral_load_s11 = log10([1275849.28049505 54045.38571 380.9929 1321.5436 1314.40864 6510.68325 83.3386 78.123226 73.13515]);
time_s11mod = [0 1 3 4 5 6 8 9 10]+5;

viral_load_s12 = log10([28182.6154 4453.23734 19167.6378 3646.1527 2076.506848 3804.1328277 819.0564 861.42516 74.022616 1377.23323 64.255471490 63 63 63]);
time_s12mod = [0 1 2 3 4 5 6 7 8 9 10 11 12 13]+6;

viral_load_s14 = log10([106246.783 6543189.12 88586.6790 6543189.129712 2636650.898 1062467.8308 143844.9888 5796.39395 6158.4821 83.378222 9412.0496 10624.67830 88.586 70 70 70]);
time_s14mod = [0 1 2 3 4 5 7 8 9 10 11 12 13 14 15 17]+1;

viral_load_s17 = log10([2614.0521 10361.832 4069.2568 12116.3392 1780.908 14167.92681 13935.83 27337.53674 83.866948 100]);
time_s17mod = [0 1 2 3 4 5 7 9 10 11]+7;

viral_load_g1 = log10([891255.8032 401989831.93 764849404.45 54136256.068 13167579.539 88713.00554 254851.410 19125.59747 13400.3404 1430.43839 1803.74699 2560.785 4593.3629 130780.38186 15709.9109 2530.7693 778.7519 3582.366 1392.53]);

viral_load_g3 = log10([3145190.663  897778.331 2544.3051 57281.910 96683.835 54750.721 65319.21804 16517.611 24847.6186 7910.223 1001.9047  5992.378 7169.51871 8569.738 1929.575 4600.390 130.368 116.93048 1482.288]);
time_g3mod = [0 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19]+5;

viral_load_g4 = log10([13123028.4369  515978.147 2434576.30 22853.731093 108014.71 15871.4403  92.4419 72.55224 891.16687 50]);
time_g4mod = [0 2 3 4 5 6 7 9 10]+4;

viral_load_g8 = log10([4243301.3385 23756.19217 46258.7851 10262.476  979.748 421.986953 572.8577 106.02984  119.961981 113.3741 ]);
time_g8mod = [0 1 2 3 4 5 6 7 8 9]+6;


time_s3mod = [0 1 2 3 4 5 6 7 8 9 10 11 12]+4; 
time_s2mod = [0,7,8,10,11,12,13,14]+7;
time_s4mod = [0 4 7 9 11 12 13]+7;
time_s5mod =  [1 2 7 8 10 12 13 14 15 16 17 18 19 20 21 22]+2; %adding rounded lags
time_s6mod =  [1 2 4 5 6 7 9 10 11 12 13 14 15 16]+3;
time_s10mod = [0 1 4 5 6 7 8 10]+6;
time_s18mod = [1 2 3 4 5 6 7 8 9 10 11 13 14 15 17 19 20]+1;
time_g1mod =  [1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19]+1;
time_g2mod =  [0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17]+1;
time_g5mod =  [1 2 3 4 5 6 7 8 9 10 11 12 13 14 16]+1;
time_g6mod =  [1 2 3 4 5 6 7 9 10 13 14]+3;
time_g7mod =  [1 2 3 4 7 8 9 10 11 12]+2;

for ii = 1:24

    vecvec = [viral_load_s2(find(time_s2mod == ii));...
        viral_load_s3(find(time_s3mod==ii));...
        viral_load_s4(find(time_s4mod==ii));...
        viral_load_s5(find(time_s5mod == ii));...
        viral_load_s6(find(time_s6mod == ii));...
        viral_load_s10(find(time_s10mod == ii));...
        viral_load_s11(find(time_s11mod == ii));...
        viral_load_s12(find(time_s12mod == ii));...
        viral_load_s14(find(time_s14mod == ii));...
        viral_load_s17(find(time_s17mod == ii));...
        viral_load_s18(find(time_s18mod == ii));...
        viral_load_g1(find(time_g1mod == ii));...
        viral_load_g2(find(time_g2mod == ii));...
        viral_load_g3(find(time_g3mod == ii));...
        viral_load_g5(find(time_g5mod == ii));...
        viral_load_g6(find(time_g6mod == ii));...
        viral_load_g7(find(time_g7mod == ii));...
        viral_load_g8(find(time_g8mod == ii))];
        
    mean_vl(ii) = mean(vecvec);
    std_vl(ii) = std(vecvec);
    
    max_vl(ii) = max(vecvec);
    if min(vecvec)<2.2
    min_vl(ii) = 0;
    else
        min_vl(ii) = min(vecvec);
    end
end



figure
hold on 
fill([1:24, fliplr(1:24)],[max_vl,fliplr(min_vl)],[222 235 239]/255)
plot([1:24],max_vl,'o-','Color',[60 80 110]/255,'LineWidth',2,'MarkerSize',6)
plot([1:24],min_vl,'o-','Color',[60 80 110]/255,'LineWidth',2,'MarkerSize',6)
scatter(time_s2mod,viral_load_s2,30,[171,203,214]/255,'filled')
scatter(time_s3mod,viral_load_s3,30,[171,203,214]/255,'filled')
scatter(time_s4mod,viral_load_s4,30,[171,203,214]/255,'filled')
scatter(time_s5mod,viral_load_s5,30,[171,203,214]/255,'filled')
scatter(time_s6mod,viral_load_s6,30,[171,203,214]/255,'filled')
scatter(time_s10mod,viral_load_s10,30,[171,203,214]/255,'filled')
scatter(time_s11mod,viral_load_s11,30,[171,203,214]/255,'filled')
scatter(time_s12mod,viral_load_s12,30,[171,203,214]/255,'filled')
scatter(time_s14mod,viral_load_s14,30,[171,203,214]/255,'filled')
scatter(time_s17mod,viral_load_s17,30,[171,203,214]/255,'filled')
scatter(time_s18mod,viral_load_s18,30,[171,203,214]/255,'filled')
scatter(time_g1mod,viral_load_g1,30,[171,203,214]/255,'filled')
scatter(time_g2mod,viral_load_g2,30,[171,203,214]/255,'filled')
scatter(time_g3mod,viral_load_g3,30,[171,203,214]/255,'filled')
scatter(time_g5mod,viral_load_g5,30,[171,203,214]/255,'filled')
scatter(time_g6mod,viral_load_g6,30,[171,203,214]/255,'filled')
scatter(time_g7mod,viral_load_g7,30,[171,203,214]/255,'filled')
scatter(time_g8mod,viral_load_g8,30,[171,203,214]/255,'filled')
plot([0 24],[2 2],'k--','LineWidth',1)
xlabel('Time (days)')
ylabel('log_{10}(copies/ml)')
set(gca,'FontSize',20)
title('Viral load')

lower_St = max([mean_vl-3*std_vl],0)
lower_St(find(lower_St<2.3))=0;
upper_St=mean_vl+3*std_vl
upper_St(1) = 8.7;
upper_St(2) = 12;
upper_St(4) = 10.1;
upper_St(5) = 9;
lower_St(4) = 3.1;
lower_St(5) = 3.2;

figure
hold on 
fill([1:24, fliplr(1:24)],[upper_St,fliplr(lower_St)],[222 235 239]/255)
plot([1:24],upper_St,'o-','Color',[60 80 110]/255,'LineWidth',2,'MarkerSize',6)
plot([1:24],lower_St,'o-','Color',[60 80 110]/255,'LineWidth',2,'MarkerSize',6)
scatter(time_s2mod,viral_load_s2,30,[171,203,214]/255,'filled')
scatter(time_s3mod,viral_load_s3,30,[171,203,214]/255,'filled')
scatter(time_s4mod,viral_load_s4,30,[171,203,214]/255,'filled')
scatter(time_s5mod,viral_load_s5,30,[171,203,214]/255,'filled')
scatter(time_s6mod,viral_load_s6,30,[171,203,214]/255,'filled')
scatter(time_s10mod,viral_load_s10,30,[171,203,214]/255,'filled')
scatter(time_s11mod,viral_load_s11,30,[171,203,214]/255,'filled')
scatter(time_s12mod,viral_load_s12,30,[171,203,214]/255,'filled')
scatter(time_s14mod,viral_load_s14,30,[171,203,214]/255,'filled')
scatter(time_s17mod,viral_load_s17,30,[171,203,214]/255,'filled')
scatter(time_s18mod,viral_load_s18,30,[171,203,214]/255,'filled')
scatter(time_g1mod,viral_load_g1,30,[171,203,214]/255,'filled')
scatter(time_g2mod,viral_load_g2,30,[171,203,214]/255,'filled')
scatter(time_g3mod,viral_load_g3,30,[171,203,214]/255,'filled')
scatter(time_g5mod,viral_load_g5,30,[171,203,214]/255,'filled')
scatter(time_g6mod,viral_load_g6,30,[171,203,214]/255,'filled')
scatter(time_g7mod,viral_load_g7,30,[171,203,214]/255,'filled')
scatter(time_g8mod,viral_load_g8,30,[171,203,214]/255,'filled')
plot([0 24],[2 2],'k--','LineWidth',1)
xlabel('Time (days)')
ylabel('log_{10}(copies/ml)')
set(gca,'FontSize',20)
title('Viral load')
ylim([0 12])
xlim([0 21])
set(gca,'ytick',linspace(0,12,5))

save('viral_load_boundsNEW','lower_St','upper_St')

%%

no_ventilation = [1;...
10.810810810810807;...
8.108108108108127;...
6.306306306306311;...
16.216216216216253;...
9.00900900900902;...
19.819819819819827;...
31.531531531531556;...
28.82882882882882;...
27.927927927927925;...
27.927927927927925;...
29.72972972972974;...
32.43243243243245;...
18.918918918918934;...
19.819819819819827;...
39.639639639639654;...
44.14414414414415;...
56.75675675675676;...
58.55855855855856;...
69.36936936936937;...
76.57657657657657;...
65.76576576576578;...
130.43478260869574];

with_ventilation = [54.95495495495496;...
90.09009009009009;...
86.48648648648647;...
92.79279279279278;...
226.08695652173924;...
208.695652173913;...
139.13043478260875;...
130.43478260869574;...
165.21739130434798;...
252.17391304347848;...
443.47826086956525;...
356.52173913043475;...
460.86956521739125];

save('IL6_herold_individual.mat','no_ventilation','with_ventilation')

violin_mat_IL6 = [no_ventilation,[with_ventilation;repmat(NaN,10,1)]];
figure
hold on 
violinplot(violin_mat_IL6)
ylabel('pg/ml')
set(gca,'FontSize',20)
title('IL-6')
set(gca,'xticklabels',{'No','Yes'})
xlabel('Ventilation')

violin_mat_IL6 = [no_ventilation;with_ventilation];
figure
hold on 
violinplot(violin_mat_IL6)
ylabel('pg/ml')
set(gca,'FontSize',20)
title('IL-6')
set(gca,'xticklabels',{''})


%%


AS = [83.66;...
17.46;...
36.96;...
3.73;...
109.64;...
3.73;...
3.73;...
3.73;...
3.73;...
3.73;...
3.73;...
51.44;...
3.73;...
3.73;...
148.93;...
3.73;...
3.73;...
%1530.48;...
6.31;...
159.58;...
3.73;...
3.73;...
17.46;...
3.73;...
19.32;...
10.74;...
3.73;...
3.73;...
6.31;...
3.73;...
10.99;...
3.73;...
3.73;...
21.56;...
3.73;...
3.73;...
6.31];

S = [3.73;...
245.2;...
87.18;...
310.56;...
214.9;...
224.51;...
163.18;...
171.39;...
124.44;...
29.88;...
196.49;...
76.35;...
195.43;...
32.44;...
345.62;...
3.73;...
171.39;...
180.28;...
92.11;...
158.44;...
224.51;...
191.38;...
196.37;...
218.29;...
175.04;...
158.13;...
50.56;...
106.91;...
81.69;...
106.91;...
66.68;...
184.78;...
200.72;...
158.65;...
76.35;...
66.68;...
184.78];

save('GCSF_Long_individual.mat','AS','S')

violin_mat_GCSF = [[AS;NaN],S];
figure
hold on 
violinplot(violin_mat_GCSF)
ylabel('pg/ml')
set(gca,'FontSize',20)
title('G-CSF')
set(gca,'xticklabels',{'No','Yes'})
xlabel('Symptomatic')

violin_mat_GCSF = [AS;S];
figure
hold on 
violinplot(violin_mat_GCSF)
ylabel('pg/ml')
set(gca,'FontSize',20)
title('G-CSF')
set(gca,'xticklabels',{''})
